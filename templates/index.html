<!DOCTYPE html>
<html>
<head>
    <title>3D Tic Tac Toe (4x4x4)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(120deg, #e3ffe8 0%, #d0e9ff 100%);
            margin: 0;
            min-height: 100vh;
            padding-bottom: 30px;
        }
        h2 {
            margin: 0 0 36px 0;
            padding: 40px 0 0 0;
            font-weight: 900;
            text-align: center;
            color: #245c8c;
            letter-spacing: 2.4px;
            font-size: 2.6em;
            text-shadow: 0 4px 16px #b0e0ff80;
        }
        .layer-container {
            display: flex;
            gap: 52px;
            justify-content: center;
            align-items: flex-end;
            margin-bottom: 36px;
            flex-wrap: wrap;
        }
        .layer {
            background: rgba(255,255,255,0.89);
            border: 4px solid #b2ebf2;
            border-radius: 30px;
            padding: 28px 22px 26px 22px;
            box-shadow: 0 4px 40px #90caf980, 0 2px 16px #b2ebf240;
            min-width: 260px;
            max-width: 98vw;
            margin-bottom: 8px;
            position: relative;
            transition: background 0.5s;
        }
        .layer:nth-child(1) { background: linear-gradient(150deg, #f5e9ff 0%, #b2ebf2 90%); border-color: #7e57c2;}
        .layer:nth-child(2) { background: linear-gradient(150deg, #fffde7 0%, #ffe0b2 90%); border-color: #ffd54f;}
        .layer:nth-child(3) { background: linear-gradient(150deg, #b2dfdb 0%, #fff59d 90%); border-color: #4db6ac;}
        .layer:nth-child(4) { background: linear-gradient(150deg, #c5e1a5 0%, #ffccbc 90%); border-color: #81c784;}
        .layer b {
            font-size: 1.36em;
            color: #213a5e;
            font-weight: bold;
            display: block;
            margin-bottom: 15px;
            letter-spacing: 1.6px;
            text-shadow: 0 1px 3px #f9fbe7c0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            grid-gap: 13px;
            margin-bottom: 8px;
        }
        button, .grid button {
            width: 56px;
            height: 56px;
            font-size: 2.15em;
            border-radius: 16px;
            border: 3px solid #bdbdbd;
            background: linear-gradient(145deg, #f6fafd 70%, #e9f7fd 100%);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.17s, border 0.18s, color 0.18s, box-shadow 0.16s, transform 0.14s;
            box-shadow: 0 2px 12px #64b5f680, 0 1px 3px #fff9c440;
            outline: none;
        }
        button:hover, .grid button:hover {
            background: linear-gradient(135deg, #c5e1fa 0%, #e3f2fd 100%);
            border-color: #2196f3;
            box-shadow: 0 2px 22px #81d4fa80, 0 1px 6px #b2ebf260;
            transform: scale(1.11);
        }
        button[disabled] {
            cursor: default;
            background: #ececec;
            border-color: #e0e0e0;
            box-shadow: none;
            transform: none;
        }
        .grid button[disabled][style*="color:green"] { 
            color: #1b5e20; 
            background: linear-gradient(145deg, #c8e6c9 60%, #e9fbe6 100%); 
            border-color: #43a047;
            text-shadow: 0 2px 6px #c8e6c9a0;
        }
        .grid button[disabled][style*="color:red"]   { 
            color: #b71c1c; 
            background: linear-gradient(145deg, #ffcdd2 60%, #ffeaea 100%);
            border-color: #e53935;
            text-shadow: 0 2px 6px #ffcdd290;
        }
        .winner {
            font-size: 2.2em;
            color: #e65100;
            margin: 36px 0 16px 0;
            font-weight: bold;
            text-align: center;
            animation: winnerglow 1.7s infinite alternate;
            letter-spacing: 2px;
            text-shadow: 0 0 18px #ffd600, 0 2px 6px #f9fbe7, 0 0 44px #fffde7;
        }
        @keyframes winnerglow { 0% { text-shadow: 0 0 12px #ffd600, 0 0 1px #fffde7; } 100% { text-shadow: 0 0 44px #ffd600, 0 0 7px #fffde7;} }
        a {
            color: #1565c0;
            font-size: 1.25em;
            font-weight: 500;
            text-decoration: underline;
            transition: color 0.16s;
            display: block;
            width: fit-content;
            margin: 22px auto 0 auto;
            letter-spacing: 1px;
        }
        a:hover {
            color: #00acc1;
            letter-spacing: 2px;
        }
        @media (max-width: 1200px) {
            .layer-container { flex-wrap: wrap; gap: 28px;}
            .layer { min-width: 185px; padding: 16px 9px 18px 9px;}
            .grid { grid-template-columns: repeat(4, 44px);}
            button, .grid button { width: 42px; height: 42px; font-size: 1.5em;}
        }
        @media (max-width: 800px) {
            h2 { font-size: 1.25em;}
            .layer-container { gap: 7px;}
            .layer { min-width: 80px; padding: 7px 4px 7px 4px;}
            .grid { grid-template-columns: repeat(4, 26px);}
            button, .grid button { width: 22px; height: 22px; font-size: 1em;}
        }
    </style>
</head>
<body>
    <h2>3D Tic Tac Toe (4x4x4)</h2>
    <div class="layer-container">
        {% for z in range(4) %}
        <div class="layer">
            <b>Layer {{z}}</b>
            <div class="grid">
                {% for x in range(4) %}
                    {% for y in range(4) %}
                        {% set val = board[x][y][z] %}
                        {% if not winner and val == 0 %}
                            <form method="post" style="display:inline;">
                                <input type="hidden" name="x" value="{{x}}">
                                <input type="hidden" name="y" value="{{y}}">
                                <input type="hidden" name="z" value="{{z}}">
                                <button type="submit" onclick="playMoveSound()" style="color:#546e7a;">â€¢</button>
                            </form>
                        {% elif val == 1 %}
                            <button disabled style="color:green;">X</button>
                        {% elif val == 2 %}
                            <button disabled style="color:red;">O</button>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% if winner %}
        <div class="winner">{{winner}}</div>
        <audio id="winSound" src="{{ url_for('static', filename='win.wav') }}"></audio>
        <script>
            window.onload = function() {
                var audio = document.getElementById('winSound');
                if(audio) { audio.play().catch(()=>{}); }
            }
        </script>
    {% endif %}
    <audio id="moveSound" src="{{ url_for('static', filename='move.wav') }}"></audio>
    <script>
        function playMoveSound() {
            var snd = document.getElementById('moveSound');
            if(snd) { snd.currentTime = 0; snd.play().catch(()=>{}); }
        }
    </script>
    <a href="{{url_for('restart')}}">Restart Game</a>
</body>
</html>
